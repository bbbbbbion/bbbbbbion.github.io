<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>六饼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="测试3">
<meta property="og:type" content="website">
<meta property="og:title" content="六饼">
<meta property="og:url" content="https://bbbbbbion.github.io/index.html">
<meta property="og:site_name" content="六饼">
<meta property="og:description" content="测试3">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="六饼">
<meta name="twitter:description" content="测试3">
  
    <link rel="alternative" href="/atom.xml" title="六饼" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar img 256.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">bbbbbbion</a></h1>
		</hgroup>

		
		<p class="header-subtitle">程序员也有一个艺术家梦。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">存档</a></li>
				        
							<li><a href="/photos">照片</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/3DSMax/" style="font-size: 10px;">3DSMax</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/NShader/" style="font-size: 10px;">NShader</a> <a href="/tags/Shader/" style="font-size: 12.5px;">Shader</a> <a href="/tags/Unity3D/" style="font-size: 20px;">Unity3D</a> <a href="/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/tags/cg/" style="font-size: 17.5px;">cg</a> <a href="/tags/lua/" style="font-size: 10px;">lua</a> <a href="/tags/ulua/" style="font-size: 10px;">ulua</a> <a href="/tags/反射/" style="font-size: 10px;">反射</a> <a href="/tags/安卓/" style="font-size: 10px;">安卓</a> <a href="/tags/小众软件/" style="font-size: 10px;">小众软件</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/插件/" style="font-size: 10px;">插件</a> <a href="/tags/操作系统使用/" style="font-size: 10px;">操作系统使用</a> <a href="/tags/热更新/" style="font-size: 12.5px;">热更新</a> <a href="/tags/编辑器扩展/" style="font-size: 10px;">编辑器扩展</a> <a href="/tags/视频/" style="font-size: 10px;">视频</a> <a href="/tags/软件安装/" style="font-size: 15px;">软件安装</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">bbbbbbion</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar img 256.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">bbbbbbion</h1>
			</hgroup>
			
			<p class="header-subtitle">程序员也有一个艺术家梦。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">存档</a></li>
		        
					<li><a href="/photos">照片</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="posts-Unity3D 图片格式和出包大小之间的关系" class="article article-type-posts" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/12/Unity3D 图片格式和出包大小之间的关系/" class="article-date">
  	<time datetime="2015-10-11T16:56:33.908Z" itemprop="datePublished">2015-10-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/12/Unity3D 图片格式和出包大小之间的关系/">Unity3D 图片格式和出包大小之间的关系</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文以PC平台说明。所用素材为:<a href="http://pan.baidu.com/s/1sOuK2/" target="_blank" rel="external">http://pan.baidu.com/s/1sOuK2/</a></p>
<h1 id="情况一:">情况一:</h1><p>一张jpg图片分辨率1024*768，在PC上占用的空间为762KB。<br>复制50张。  </p>
<h2 id="1：放到StreamingAssets目录下">1：放到StreamingAssets目录下</h2><p>打包后，50张图在生成的包的StreamingAssets目录下，且每个图片的空间为762KB。<br>StreamingAssets目录大小为37.2MB。即没有压缩、没有二进制打包。StreamingAssets目录下的保持原样。在Unity中改变图片的纹理压缩格式，对打出的包的大小没有影响，即只和原始格式有关。</p>
<h2 id="2：放到Resources目录下">2：放到Resources目录下</h2><p>图片的纹理格式为RGB ETC1 4bit时，每个图占用内存384KB（逐像素算，不同于外存中图片大小的算法）。384*50=19200<br>再看最终resources.assets文件大小为19208KB（18.7MB）。即约等于每个图片的内存大小之和。</p>
<h1 id="情况二:">情况二:</h1><p>对该jpg图片进行压缩。<br>本人使用Sage Thumbs的右键快捷方式：转换为jpg，把50个图片转换了一下（保持尺寸不变），每个图片在PC的存储空间从762KB变成184KB。<br>再放到StreamingAssets下打包,StreamingAssets包的大小变为8.99MB。<br>放到resources目录下打包，依旧使用RGB ETC1 4bit。最终结果依旧为19208KB（18.7MB）。  </p>
<p>综上：图片若是放在StreamingAssets目录下，尽量减少图片的占用空间，从而减少包的尺寸。<br>Resources目录下打包，图片最终占用空间和其最终运行时占用的内存一致，即跟其纹理压缩格式有关。另外Resources目录打包后是以二进制格式保存的，比较安全。</p>
<h1 id="情况三:">情况三:</h1><p>打assetbundle<br>回到每张图外存762KB的情况，使用RGB ETC1 4bit （每个图384KB）的纹理压缩格式。对每个图打成assetbundle，每个assetbundle大小为200KB。<br>再使用RGB 16bit（每个图占用1.5MB）的纹理压缩格式，每个图的assetbundle大小为470KB。<br>再使用RGB 16bit的纹理压缩格式，再把图片外存改成184KB（按照上述情况二所述），打出的assetbundle大小为582KB。</p>
<p>综上：可见assetbundle大小也和纹理压缩格式有关，纹理压缩格式占用空间越大，bundle也越大。相对来说assetbundle在纹理压缩的基础上还进一步压缩了，从而减少大小。<br>另外和原始外存压缩格式也有关，具体关系本人也没有深究。<br>由于assetbundle一般不放到Resources目录下，所以这里不讨论放到Resources目录下的情况。<br>（实际上我也测试了一下，把assetbundle单独放到Resources目录下，打出的包没有resources.assets这个文件）</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D mecanim杂记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/04/Unity3D mecanim杂记/" class="article-date">
  	<time datetime="2015-10-04T13:33:03.000Z" itemprop="datePublished">2015-10-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/04/Unity3D mecanim杂记/">Unity3D mecanim杂记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以下皆以4.5左右版本Unity3D为准</p>
<h1 id="1：Layer">1：Layer</h1><p>Mecanim的layer可以在一个角色上播放超过一个动画。<br>较高的layer会盖过下面的layer, 不过layer 0以外的layer weight预设是0, 要set为1才会播放。<br>例如layer 0是站立或跑走的动画 layer 1是 挥剑的动画<br>用body mask控制layer 1只影响上半身<br>脚本中要挥剑就 Animator.SetLayerWeight(1,1f);<br>完成后Animator.SetLayerWeight(1,0f); </p>
<p>base layer以上的新layer初始的weight值是0, 一定要用script將weight改成1才可以播动画<br>当base layer和new layer同時播放影响同一关节的动画时,会只播放层数高的layer  </p>
<p>这些后来增加的层的权重在运行的时候默认是0的，也就是没有影响，需要自己在初始化的时候或者特定需要的时候设定层的权重。（使用animator.SetLayerWeight）</p>
<p><a href="http://docs.unity3d.com/Documentation/Components/class-AvatarBodyMask.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Components/class-AvatarBodyMask.html/</a><br><a href="http://docs.unity3d.com/Documentation/Manual/AnimationLayers.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/AnimationLayers.html/</a></p>
<h1 id="2：AnimatorStateInfo">2：AnimatorStateInfo</h1><pre><code>AnimatorStateInfo <span class="keyword">state</span>Info = animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>);
if (<span class="keyword">state</span>Info.IsName(<span class="string">"Base Layer.RifleIdle"</span>))
{
    //Debug.Log(<span class="string">"stateInfo.length:"</span> + <span class="keyword">state</span>Info.length);
    //Debug.Log(<span class="string">"stateInfo.normalizedTime:"</span> + <span class="keyword">state</span>Info.normalizedTime);
    //if (<span class="keyword">state</span>Info.normalizedTime &gt;= <span class="keyword">state</span>Info.length)
    if (<span class="keyword">state</span>Info.normalizedTime &gt;= <span class="number">0.01</span>f)
    {
        gun.transform.parent = leftHand.transform;//先设置父子关系，再设置位置和旋转。否则会出现闪烁。
        gun.transform.localPosition = leftHandLocalP<span class="keyword">os</span>;
        gun.transform.localRotation = Quaternion.Euler(leftHandLocalRotation);
    }
}
</code></pre><p>Animator.GetCurrentAnimatorStateInfo（int layerIndex）//注意该函数最好在update中调用，返回的才是当前实时的animatorStateInfo。若放在Start函数中调用的话，获得的只是启动时候的状态~</p>
<p><strong>AnimatorStateInfo.normalizedTime</strong><br>Normalized time of the State.<br>The integer part is the number of time a state has been looped. The fractional part is the % (0-1) of progress in the current loop<br><img src="/img/normalized time.png" alt="normalized time"></p>
<p><strong>AnimatorStateInfo.length</strong><br>Current duration of the state.<br>In seconds Can vary when the State contains a Blend Tree.</p>
<h1 id="3：Animation_Clip_Inspector">3：Animation Clip Inspector</h1><p><a href="http://docs.unity3d.com/Documentation/Manual/RootMotion.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/RootMotion.html/</a><br><a href="http://docs.unity3d.com/Documentation/Components/class-AnimationClip.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Components/class-AnimationClip.html/</a><br><img src="/img/animation clip inspector.png" alt="Animation clip inspector"><br>Bake Into pose勾选后，人物就不能跟随动画进行位置的改变相应。<br>不勾选，人物可以跟随动画进行相应位置的改变。</p>
<h1 id="4：Overriding_Root_Motion">4：Overriding Root Motion</h1><p><strong>MonoBehaviour.OnAnimatorMove()</strong><br>Callback for processing animation movements for modifying root motion.<br>This callback will be invoked at each frame after the state machines and the animations have been evaluated, but before OnAnimatorIK.</p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Example</span> : <span class="title">MonoBehaviour</span> {
    <span class="function"><span class="keyword">void</span> <span class="title">OnAnimatorMove</span>(<span class="params"></span>) </span>{
          Animator animator = GetComponent&lt;Animator&gt;();
        <span class="keyword">if</span> (animator) {
            Vector3 newPosition = transform.position;
            newPosition.z += animator.GetFloat(<span class="string">"Runspeed"</span>) * Time.deltaTime;
            transform.position = newPosition;
        }    
    }
}
</code></pre><p>一个常规的通过characterController控制移动的写法:  </p>
<pre><code>void OnAnimatorMove<span class="params">()</span>
{
    Vector3 deltaPosition = animator.deltaPosition;
    <span class="keyword">if</span> <span class="params">(controller.isGrounded)</span>
    {
        xVelocity = animator.GetFloat<span class="params">(<span class="string">"Speed"</span>)</span> <span class="built_in">*</span> controller.velocity.x <span class="built_in">*</span> <span class="number">0.25</span>f;
        zVelocity = animator.GetFloat<span class="params">(<span class="string">"Speed"</span>)</span> <span class="built_in">*</span> controller.velocity.z <span class="built_in">*</span> <span class="number">0.25</span>f;
    }
    verticalSpeed += Physics.gravity.y <span class="built_in">*</span> Time.deltaTime;
    <span class="keyword">if</span> <span class="params">(verticalSpeed &lt;= <span class="number">0</span>)</span>
    {
        animator.SetBool<span class="params">(<span class="string">"Jump"</span>, <span class="literal">false</span>)</span>;
    }

    deltaPosition.y = verticalSpeed <span class="built_in">*</span> Time.deltaTime;
    <span class="keyword">if</span> <span class="params">(!controller.isGrounded)</span>
    {
        deltaPosition.x = xVelocity <span class="built_in">*</span> Time.deltaTime;
        deltaPosition.z = zVelocity <span class="built_in">*</span> Time.deltaTime;
    }
    controller.Move<span class="params">(deltaPosition)</span>;

    <span class="keyword">if</span> <span class="params">(<span class="params">(controller.collisionFlags &amp; CollisionFlags.Below)</span> != <span class="number">0</span>)</span>
    {
        verticalSpeed = <span class="number">0</span>;
    }

    transform.rotation = animator.rootRotation;
}
</code></pre><h1 id="5_:OnAnimatorIK(int_layerIndex)">5 :OnAnimatorIK(int layerIndex)</h1><p>常用方法：<br>animator.SetIKPosition(AvatarIKGoal.LeftHand,…);<br>animator.SetIKPositionWeight();</p>
<p>animator.SetIKRotation<br>animator.SetIKRotationWeight</p>
<p>animator.SetLookAtPosition<br>animator.SetLookAtWeight
 </p>
<h1 id="6：一些技巧：">6：一些技巧：</h1><h2 id="6-1：控制blendTree中motion的动画速度">6.1：控制blendTree中motion的动画速度</h2><p><img src="/img/blend tree1.png" alt="blend tree1"><br>FireStatus参数控制，是蹲下射击还是站立射击。</p>
<p><img src="/img/blend tree2.png" alt="blend tree2"><br>如上图，通过修改绿色圈的速度可以修改该动画的播放速度，从而提高射击速度。但是目前版本4.3还没有提供直接的api用代码控制它。虽然可以通过设置animator.Speed来整体提高速度，但是会影响到其它动画，可控性很低。<br>可以通过每个动画单独设置一个blendTree,该blendTree使用两个motion,且这两个motion都添加这个动画，然后设置最低速度、最大速度。然后用一个float型变量控制在这两个motion之间切换。如下图：  </p>
<p><img src="/img/blend tree3.png" alt="blend tree3">  </p>
<p><img src="/img/blend tree4.png" alt="blend tree4"><br>这样在程序里结合使用FireSpeed参数来控制射击速度了。</p>
<h2 id="6-2：动画覆盖时候的参数设置解决覆盖扭曲的问题，如站立射击，跑动射击">6.2：动画覆盖时候的参数设置解决覆盖扭曲的问题，如站立射击，跑动射击</h2><p>这里以站立射击，跑动射击为例说明。涉及到的动作有：站立idle状态，站立射击状态，跑动瞄准状态，跑动射击状态。如下图（跑动射击和跑动瞄准不容易区分这里不示意了）。</p>
<p><img src="/img/shoot model.png" alt="模型动作示例图"><br>常规做法是站立、跑动放一个layer，射击动作新建一个layer，通过mask，使得下半身不动。调整weight为1，使得射击动作的层覆盖weight较低的层（base layer的weight为0），这里注意一点，weight不一定设置为1，weight值越高则可以覆盖低weight的动作，而且weight值还形象自身动作的力度，weight=1,则按照最大动作幅度表现动作，weight=0.5则动作幅度只有原来的一半。<br>需要注意射击层的Blending属性。  </p>
<p><img src="/img/mask blending type.png" alt="mask blending type"><br>Additive是在原来动作的基础上只添加新的动作。<br>Override是覆盖原来动作。<br>如从站立过渡到站立射击状态，若这里选择的是Additive。相对于站立动作，射击动作就一个手部的抖动，因此现在的动作就是站立手部抖动，看起来蛋疼且莫名其妙。若选择的是Override,一切完好。若非要用Additive不可，那么还需要一个站立瞄准的动作，切换到射击状态前，确保人物已经切换到站立瞄准的状态了，这样在站立瞄准的基础上Additive的射击就不会蛋疼了。<br>跑动射击的话，我们在跑动瞄准的基础上Additive射击的动作自然没有问题，问题是若使用Override方式的话，很蛋疼。上半身枪口的指向不再是正前方。。。个人猜测是跑动瞄准的脊柱和射击动作的脊柱不一致吧。。。</p>
<h2 id="6-3：RootTransform_Rotation_BasedUpon参数设置">6.3：RootTransform Rotation   BasedUpon参数设置</h2><p><img src="/img/root transform rotation basedupon.png" alt="BasedUpon参数"><br>Original的提示是：Keep the rotation as it is authored in the source file<br>Body Oritation的提示是：Keeps the upper body pointing forward</p>
<h2 id="6-4_不要把Unity3D工程A中的中的fbx文件拷贝供其它工程使用">6.4 不要把Unity3D工程A中的中的fbx文件拷贝供其它工程使用</h2><p>这样做在另一个工程中会出现很多意想不到的现象，别的工程要用的话，必须使用源fbx文件。</p>
<h2 id="6-5_Mask,Curves,_Events">6.5 Mask,Curves, Events</h2><p>具体哪个版本的Unity3D为导入的动作加入了这几个东西，已经记不得了。</p>
<h3 id="6-5-1_Mask">6.5.1 Mask</h3><p>略</p>
<h3 id="6-5-2_Curves">6.5.2 Curves</h3><p>Curves和Events都是一个动作上可以添加多个的。<br>Curves通过添加曲线来控制动画各个部位的播放速度。<br>一个动作添加了多个Curve的话，会取均值？？<br>如下图添加了一个叫做RollCurve的Curve，若动作的Animator Controller也声明了float型的“RollCurve”动作，则这个两个便挂钩了。在程序中可以获得当前Curve的值<br><img src="/img/add curves.png" alt="add curves"><br>Debug.Log(“rollCurveValue is:”+animator.GetFloat(“RollCurve”));<br>详见：<a href="http://docs.unity3d.com/Documentation/Manual/AnimatorCurves.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/AnimatorCurves.html/</a></p>
<h3 id="6-5-3_Events">6.5.3 Events</h3><p>可以为动作添加事件，当动作运行到添加事件的时间点后，会触发事件的执行，同样一个动作上可以添加多个事件，满足条件的时候都会执行的。<br><img src="/img/add many events.png" alt="add many events"><br>下图为添加事件的窗口。Function后的textbox对应动作控制脚本上的函数名称，该函数对public还是private没有要求，但是该函数只能带0个或者1个参数，参数类型如下图。<br><img src="/img/Add events.png" alt="Add events"></p>
<h2 id="6-6_Any_State-&gt;Death需要注意的事项">6.6 Any State-&gt;Death需要注意的事项</h2><p>默认从Any State到其它状态添加了动作转换过渡后，默认条件如下图：<br><img src="/img/any state 2 death.png" alt="any state 2 death"><br>但是该条件一运行便会执行。于是我们想通过某个bool变量如isDeath来控制，于是删除Exit Time这个条件，只使用bool变量来控制。结果是动作会来回一直闪烁，非常奇怪。解决方案是保留该Exit Time条件，根据需要 调节后面的时间，然后结合bool变量来控制</p>
<h2 id="6-7_移除动作模型保留动作文件，无法减少占用空间">6.7 移除动作模型保留动作文件，无法减少占用空间</h2><p>由于要在unity3d中调相关的参数，一般从3dsmax中导出的fbx都是带有模型的动作。在unity3d中做好一切工作后，想着可以ctrl+d把动作文件从模型中复制出来（选中动作文件，ctrl+d会自动复制一个到project目录中），然后删除原来的模型，达到减少安装包大小的目地。事实上测试了，无法。Unity其实已经做了相关的优化的，打包的时候打入的就是动作文件， 而不是包括冗余的模型。<br>需要注意的是，再修改相关参数的话就没法了…需要重新导入模型文件…<br>另一方面，6.5中提到的设置的events事件在模型文件被删除后依旧会保留的，只是我们看不到了，无法编辑了而已！~~</p>
<h2 id="6-8_SetBool和SetTrigger函数比较，以及bool变量和trigger变量比较">6.8 SetBool和SetTrigger函数比较，以及bool变量和trigger变量比较</h2><p>Unity4.3在animator面板内引入了Trigger这个变量（以前只有int ,float,bool三种）</p>
<h3 id="6-8-1_SetBool,SetTrigger函数">6.8.1 SetBool,SetTrigger函数</h3><p>在animator界面要是需要用一个bool变量（这里以bool IsAttack为例）来控制动画的来回切换就要先设置IsAttack为true，然后在适当的时候设置为false。<br>如何获取适当的时候呢？一般都是通过animator.GetCurrentAnimatorStateInfo来获取当前的动画播放信息。<br>SetBool比较简单，代码如下：  </p>
<pre><code><span class="keyword">state</span>Info0 = animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>);
if(<span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Attack"</span>))
{
    if(<span class="keyword">state</span>Info0.normalizedTime&gt;<span class="number">0.9</span>f)
    {
        animator.SetBool(<span class="string">"IsAttack"</span>,false);
    }
}
if(Input.GetKeyDown(KeyCode.A))
{
    animator.SetBool(<span class="string">"IsAttack"</span>,true);
}
</code></pre><p>SetTrigger代码如下（这里用SetTrigger来操纵animator界面中声明为bool类型的变量，发现竟然可以操纵）：  </p>
<pre><code><span class="keyword">state</span>Info0 = animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>);
if(<span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Attack"</span>))
{
    if(<span class="keyword">state</span>Info0.normalizedTime&gt;<span class="number">0.9</span>f)
    {
        animator.SetBool(<span class="string">"IsAttack"</span>,false);
    }
}
if(Input.GetKeyDown(KeyCode.A))
{
    animator.SetTrigger(<span class="string">"IsAttack"</span>);
}
</code></pre><p>SetTrigger实质其实就是设置了IsAttack为true了。但事实上SetTrigger函数是用来操纵Trigger类型变量的。如下介绍</p>
<h3 id="6-8-2_Bool变量，Trigger变量">6.8.2 Bool变量，Trigger变量</h3><p><a href="http://answers.unity3d.com/questions/600268/mecanim-animation-parameter-types-boolean-vs-trigg.html/" target="_blank" rel="external">http://answers.unity3d.com/questions/600268/mecanim-animation-parameter-types-boolean-vs-trigg.html/</a><br>这里有讨论。<br>下图为使用Trigger变量作为条件的截图，它不像Bool变量那样有true，false之分。<br><img src="/img/trigger inspector.png" alt="trigger inspector"><br>通过使用SetTrigger函数，可以先设置Tigger变量的值为true,使得进入另一个状态，然后立马Tigger变量又变为false。这样就不用像SetBool函数那边，还要考虑在合适的时候设置为false的问题。<br>比如人物从Idle状态到攻击状态，通过Tigger类型变量isAttack来控制。<br>从Idle到攻击，用isAttack来控制。这样我们进入攻击后，该变量又回到false。<br>攻击再回到Idle,用ExistTime来控制。这样就比较好的解决了问题。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D bug积累" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/03/Unity3D bug积累/" class="article-date">
  	<time datetime="2015-10-03T10:47:28.000Z" itemprop="datePublished">2015-10-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D bug积累/">Unity3D bug积累</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1：mp3没有声音<br>如图：导入到场景中的mp3格式的音乐在预览界面点击播放，听不到声音。但是用外部播放器打开对应文件夹下的该文件却有声音的。<br>把文件删除、重新导入，依旧没有声音。<br>最后重启Unity3D，尼玛，可以了。。。这个BUG，3年前就存在了。。</p>
<p>2:图片导入后Could not create texture from XXXX;File could not be read.<br>无论是直接复制粘贴到unity3d文件夹内还是用import都报错如下。图片是白色的，不显示内容。<br><img src="/img/unity pic bug.png" alt="图片显示白色"><br>解决方法：用photoshop打开，重新保存一道。可能是编码的问题吧~~~</p>
<p>2：Build Problem - asset is marked as don’t save<br>20140512（汶川六年）<br>今天做电影学院3D互动项目，切换为成android平台后，build and run的时候报了一些列错。如下图：<br>Error 1:<br>An asset is marked as dont save, but is included in the build:<br>UnityEditor.HostView:OnGUI()<br>Error 2:<br>Building - Failed to write file: sharedassets0.assets UnityEditor.HostView:OnGUI()<br>Error 3:<br>Error building Player: Couldn’t build player because of unsupported data on target platform.</p>
<p>这是论坛上对该问题的讨论：<a href="http://answers.unity3d.com/answers/706282/view.html" target="_blank" rel="external">http://answers.unity3d.com/answers/706282/view.html</a><br>我关闭unity后，重新打开。问题消失</p>
<p>3:Profiler LogStringToConsole<br>Necromancy项目，主角死亡后，复活后帧率极度下降，打开profiler<br><img src="/img/profiler log.png" alt="profiler示图">  </p>
<p>发现FriendAnimationControl.cs脚本中的debug占用了几乎全部的内存消耗。<br>问题是FriendAnimationControl.cs上的脚本已经完全注释了Debug.Log以及Printf了。<br>最终终于找到原因：<a href="http://forum.unity3d.com/threads/profiler-showing-logstringtoconsole-what-is-that.237589/#post-1577507" target="_blank" rel="external">http://forum.unity3d.com/threads/profiler-showing-logstringtoconsole-what-is-that.237589/#post-1577507</a>  </p>
<p><img src="/img/unity answer.png" alt="解释">  </p>
<p><img src="/img/OpenEditorLog.png" alt="打开Editor Log"><br>如上图，在Console面板点击Open Editor Log<br>在详细的Editor Log中发现了很多句如下信息：<br>!(Log信息)[/img/LogClear.png]<br>这些信息，被当作垃圾debug信息，没有显示在Console的面板中，只能通过Log日志看到。<br>于是追本溯源，在FriendAnimationControl.cs脚本中发现在主角死亡的时候设置了<code>animator.runtimeAnimatorController = null;</code><br>导致主角复活后，友军继续执行animator.SetBool之类的操作，报错Animator has not been initialized。可惜的是该报错被当作垃圾信息了……</p>
<p>4: Shader wants normals, but the mesh XXX doesn’t have them的警告</p>
<p><img src="/img/shader want normals.png" alt="shader wants normals">  </p>
<p>找到名为XXX的mesh，发现其用的shader 是diffuse，根本不需要法线贴图。<br>再仔细看看，这个XXX mesh是用代码生成的。于是最后调用了RecalculateNormals()方法，顺利解决。（_trailMesh.RecalculateNormals()）;</p>
<p>5：Setting the parent of a transform which resides in a prefab is disabled to prevent data corruption<br>出现情况描述：Resource.Load了一个Prefab,并as强制转换为GameObject类型bb。然后设置bb的父物体为场景中已知的物体。报错如上。<br>解决方法：还必须Instantiate一下bb，并存到cc中,然后就可以随便操纵cc了，不会发生上述报错：<br>GameObject bb=Resources.Load(XXX) as GameObject;<br>GameObject cc=Instantiate(bb);</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D Navmesh杂记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/03/Unity3D Navmesh杂记/" class="article-date">
  	<time datetime="2015-10-03T10:28:08.000Z" itemprop="datePublished">2015-10-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D Navmesh杂记/">Unity3D Navmesh杂记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1：navmesh_agent和character_controller">1：navmesh agent和character controller</h1><p>当使用navmesh要实现物体不和其余collider碰撞需要为物体添加collider组件。<br>但是添加了collider后，会发现相机抖动厉害。<br>经测试是navmesh agent和character controller之间的冲突，但是程序需要又不能删除某一个，故考虑动态关闭一个即可。<br>故程序中根据情况，对navmesh agent进行enable的开关</p>
<h1 id="2：判断是否到达目标点destination">2：判断是否到达目标点destination</h1><p>当设置了navMeshAgent.destination后，如何判断是否到达目标点，由于api中没提供直接的接口<br>经过测试实时获得当前物体和目标的距离来进行判断：<br>Vector3.Distance(transform.position, navMeshAgent.destination) &lt; 0.5f<br>PS:api中提供有remainingDistance接口用来获得距离目标点还有多远的距离。但是该接口在刚设置destination后获得的距离也是0。因此基本不可取<br>PS2:也可以用： navMeshAgent.path.corners.Length == 1，但是有时候会失效。法科</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D优化总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/03/Unity3D优化总结/" class="article-date">
  	<time datetime="2015-10-03T10:23:27.000Z" itemprop="datePublished">2015-10-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D优化总结/">Unity3D优化总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>不要使用OnGUI()，它很慢，非常慢。</li>
<li>当需要频繁修改物体的localScale时，移除其collider组件，否则会非常影响帧率。</li>
<li>使用OnBecameVisible()/OnBecameInvisible()配对使用修改enabled属性，使得只有在对象可见时脚本才会执行。<br>（物体不可见的时候drawcall是降低了，但是若自身带有脚本，还是执行的~~~）</li>
<li>使用InvokeRepeating()代替Update()处理不需要实时的数据更新。</li>
<li>使用对象池GameObjectPool缓存频繁使用的对象。</li>
</ol>
<p>IOS平台优化建议<br>•    Keep vertex count below:<br>•    40K per frame when targeting iPhone 3GS and newer devices (with SGX GPU)<br>•    10K per frame when targeting older devices (with MBX GPU)<br>•    Keep the number of different materials per scene low - share as many materials between different objects as possible.<br>•    Set Static property on a non-moving objects to allow internal optimizations.<br>•    Use PVRTC formats for textures when possible, otherwise choose 16bit textures over 32bit.<br>•    Use combiners or pixel shaders to mix several textures per fragment instead of multi-pass approach.<br>•    If writing custom shaders, always use smallest possible floating-point types:<br>•    fixed / lowp – perfect for color, lighting information and normals,<br>•    half / mediump – for texture UV coordinates,<br>•    float / highp – avoid in pixel shaders, fine to use in vertex shader for vertex position calculations.<br>•    Minimize use of complex mathematical operations such as pow, sin, cos etc in pixel shaders.<br>•    Do not use Pixel Lights when it is not necessary – choose to have only a single (preferably directional) pixel light affecting your geometry.<br>•    Do not use dynamic lights when it is not necessary – choose baking lighting instead.<br>•    Choose to use less textures per fragment.<br>•    Avoid alpha-testing, choose alpha-blending instead.<br>•    Do not use fog when it is not necessary.<br>•    Learn benefits of Occlusion culling and use it to reduce amount of visible geometry and draw-calls in case of complex static scenes with lots of occlusion. Plan your levels to benefit from Occlusion culling.<br>•    Use skyboxes to “fake” distant geometry.<br>更多优化相关的知识：官网<br><a href="http://docs.unity3d.com/Documentation/Manual/OptimizingGraphicsPerformance.html" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/OptimizingGraphicsPerformance.html</a>
 </p>
<h1 id="Modeling_Characters_for_Optimal_Performance">Modeling Characters for Optimal Performance</h1><p>Below are some tips for designing character models to give optimal rendering speed.</p>
<h2 id="Use_a_Single_Skinned_Mesh_Renderer">Use a Single Skinned Mesh Renderer</h2><p>You should use only a single skinned mesh renderer for each character. Unity optimizes animation using visibility culling and bounding volume updates and these optimizations are only activated if you use one animation component and one skinned mesh renderer in conjunction. The rendering time for a model could roughly double as a result of using two skinned meshes in place of a single mesh and there is seldom any practical advantage in using multiple meshes.</p>
<h2 id="Use_as_Few_Materials_as_Possible">Use as Few Materials as Possible</h2><p>You should also keep the number of materials on each mesh as low as possible. The only reason why you might want to have more than one material on a character is that you need to use different shaders for different parts (eg, a special shader for the eyes). However, two or three materials per character should be sufficient in almost all cases.</p>
<h2 id="Use_as_Few_Bones_as_Possible">Use as Few Bones as Possible</h2><p>A bone hierarchy in a typical desktop game uses somewhere between fifteen and sixty bones. The fewer bones you use, the better the performance will be. You can achieve very good quality on desktop platforms and fairly good quality on mobile platforms with about thirty bones. Ideally, keep the number below thirty for mobile devices and don’t go too far above thirty for desktop games.</p>
<h2 id="Polygon_Count">Polygon Count</h2><p>The number of polygons you should use depends on the quality you require and the platform you are targeting. For mobile devices, somewhere between 300 and 1500 polygons per mesh will give good results, whereas for desktop platforms the ideal range is about 1500 to 4000. You may need to reduce the polygon count per mesh if the game can have lots of characters onscreen at any given time. As an example, Half Life 2 used 2500-5000 triangles per character. Current AAA games running on the PS3 or Xbox 360 usually have characters with 5000-7000 triangles.</p>
<h2 id="Keep_Forward_and_Inverse_Kinematics_Separate">Keep Forward and Inverse Kinematics Separate</h2><p>When animations are imported, a model’s inverse kinematic (IK) nodes are baked into forward kinematics (FK) and as a result, Unity doesn’t need the IK nodes at all. However, if they are left in the model then they will have a CPU overhead even though they don’t affect the animation. You can delete the redundant IK nodes in Unity or in the modeling tool, according to your preference. Ideally, you should keep separate IK and FK hierarchies during modeling to make it easier to remove the IK nodes when necessary.</p>
<h2 id="Simple_Checklist_to_make_Your_Game_Faster">Simple Checklist to make Your Game Faster</h2><p>•    Keep vertex count below 200K..3M per frame when targetting PCs, depending on the target GPU<br>•    If you’re using built-in shaders, pick ones from Mobile or Unlit category. They work on non-mobile platforms as well; but are simplified and approximated versions of the more complex shaders.<br>•    Keep the number of different materials per scene low - share as many materials between different objects as possible.<br>•    Set Static property on a non-moving objects to allow internal optimizations like static batching.<br>•    Do not use Pixel Lights when it is not necessary - choose to have only a single (preferably directional) pixel light affecting your geometry.<br>•    Do not use dynamic lights when it is not necessary - choose to bake lighting instead.<br>•    Use compressed texture formats when possible, otherwise prefer 16bit textures over 32bit.<br>•    Do not use fog when it is not necessary.<br>•    Learn benefits of Occlusion Culling and use it to reduce amount of visible geometry and draw-calls in case of complex static scenes with lots of occlusion. Plan your levels to benefit from ccclusion culling.<br>•    Use skyboxes to “fake” distant geometry.<br>•    Use pixel shaders or texture combiners to mix several textures instead of a multi-pass approach.<br>•    If writing custom shaders, always use smallest possible floating point format:<br>o    fixed / lowp - for colors, lighting information and normals,<br>o    half / mediump - for texture UV coordinates,<br>o    float / highp - avoid in pixel shaders, fine to use in vertex shader for position calculations.<br>•    Minimize use of complex mathematical operations such as pow, sin, cos etc. in pixel shaders.<br>•    Choose to use less textures per fragment.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D相关的各种文件目录" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/03/Unity3D相关的各种文件目录/" class="article-date">
  	<time datetime="2015-10-03T08:52:34.000Z" itemprop="datePublished">2015-10-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D相关的各种文件目录/">Unity3D相关的各种文件目录</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1：dll目录">1：dll目录</h1><h2 id="1-1_mono_dll">1.1 mono dll</h2><p>？:\Program Files (x86)\Unity安装目录名\Editor\Data\Mono\lib\mono\2.0</p>
<h2 id="1-2_其它dll，如sqlite3-dll">1.2 其它dll，如sqlite3.dll</h2><p>？:\Program Files (x86)\Unity安装目录名\Editor</p>
<h1 id="2：asset_store下载默认目录">2：asset store下载默认目录</h1><p>Win PC: C:\Users\用户名\AppData\Roaming\Unity\Asset Store</p>
<h1 id="3：persistentDataPath目录">3：persistentDataPath目录</h1><p>这是一个和Company Name、Product Name都相关的目录。<br>Win pc上：C:\Users\用户名\AppData\LocalLow\CompanyName\ProductName<br>运行软件后会建立以上目录，即persistentDataPath的目录，相同的CompanyName的产品都放在一起，通过二级目录ProductName来唯一区分产品<br>Android上：（要分内存和存储卡）基本位置都是Android/data/www.公司名.产品名/files</p>
<h1 id="4：脚本模版所在目录">4：脚本模版所在目录</h1><p>Mac: /Applications/Unity/Unity.app/Contents/Resources/ScriptTemplates<br>Win:[Unity install path] /Editor/Data/Resources/ScriptTemplates/<br>可以通过设置脚本模版的样式控制新建脚本的样式。<br>同样把脚本模版的编码方式设置为utf-8，可以解决不支持中文的问题。</p>
<h1 id="5：自带package目录">5：自带package目录</h1><p>5.0之前才自带package<br>?:\Program Files (x86)\目录名\Editor\Standard Packages</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D和3DSMax的种种" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/03/Unity3D和3DSMax的种种/" class="article-date">
  	<time datetime="2015-10-03T07:43:21.000Z" itemprop="datePublished">2015-10-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D和3DSMax的种种/">Unity3D和3DSMax的种种</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1:坐标系的统一">1:坐标系的统一</h1><p>Unity3D使用左手坐标系，Max是右手坐标系。<br>Max中模型导出fbx后导入Unity中后，X轴的旋转会变成-90°。因此需要在导出前把Max中模型的Y轴旋转向上，即旋转X轴90°。<br>方法：3DSMax中切换顶视图，此时默认坐标轴为：X轴向右，Y轴向上，Z轴指向自己。需要改成:X轴向右，Y轴指向自己，Z轴向下。这样导出的fbx在Unity中便是正常的了。</p>
<p>!(3DSMax模型导出fbx注意事项)[/img/3dsmax fbx 2 unity3d.png]<br>特别注意第2点，要修改为Local局部坐标。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/3DSMax/">3DSMax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D插件之刀光" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/03/Unity3D插件之刀光/" class="article-date">
  	<time datetime="2015-10-03T06:47:23.000Z" itemprop="datePublished">2015-10-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D插件之刀光/">Unity3D插件之刀光</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1：wiki上的开源脚本，原理：动态mesh<br>来源：<a href="http://wiki.unity3d.com/index.php?title=MeleeWeaponTrail" target="_blank" rel="external">http://wiki.unity3d.com/index.php?title=MeleeWeaponTrail</a></p>
<p>该刀光脚本由三部分组成：<br>最根本的刀光动态mesh脚本MeleeWeaponTrail.cs；刀光显示与否的控制脚本；以及刀光平滑插值脚本Interpolate.cs(<a href="http://wiki.unity3d.com/index.php/Interpolate)。其中插值脚本不是必须的。" target="_blank" rel="external">http://wiki.unity3d.com/index.php/Interpolate)。其中插值脚本不是必须的。</a><br>使用方法：把MeleeWeaponTrail.cs脚本附加到3D模型武器所在的骨骼点上，同时为该骨骼点增加两个空的子物体，一个用来指示刀光的顶部位置，一个用来指示刀光的底部位置。脚本中取消“#define USE_INTERPOLATION”的注释，可以平滑刀光，但是记得到要在工程中添加Interpolate.cs脚本。<br>把脚本MeleeWeaponTrail.cs拖到骨骼点上，Inspector界面为  </p>
<p>!(刀光插件inspector视图)[/img/melee weapon trail.png]<br>Emit表示是否发出刀光，若是想通过代码控制，一般都取消Emit的勾选<br>EmitTime表示刀光发出后多久就停止发出刀光，0表示无限大，一般默认该值<br>Material为刀光使用的材质球。。。。注意材质球使用Particles/Additive的shader<br>LifeTime表示刀光面片存在的时间，单位s<br>Colors：淡出颜色，（通过设置Colors的alpha可以很好控制刀光的透明度，一般设置alpha为50效果还不错，另外通过设置Colors可以设置刀光的颜色，而不必再做一个带颜色的刀光了）<br>Sizes:设置刀光不同部位的大小<br>Min Vertex Distance: Never make segments shorter than this<br>Max Vertex Distance: Never make segments longer than this<br>Max Angle: Never make angles between segments greater than this. Increasing it will make a faster but uglier line.<br>Auto Destruct: Destroy this object and the render object if we are not emitting and have no segments left .<br>Base,Tip就是上面提到的刀光的底部和顶端位置  </p>
<p>然后我们在刀光的控制脚本通过设置MeleeWeaponTrail.cs的Emit参数true/false来控制刀的开关。如下代码：  </p>
<pre><code>public class MeleeWeaponTrailControl : MonoBehaviour
{
    [SerializeField]
    MeleeWeaponTrail _trail;
    Animator animator;
    AnimatorStateInfo <span class="keyword">state</span>Info0;
    void Start()
    {
        animator = GetComponent<span class="variable">&lt;Animator&gt;</span>();
        _trail.Emit = false;
    }
    void Update()
    {
        <span class="keyword">state</span>Info0 = animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>);
        if (<span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Melee1"</span>)
            || <span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Melee2"</span>)
            || <span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Melee3"</span>)
            || <span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Melee4"</span>)
            || <span class="keyword">state</span>Info0.IsName(<span class="string">"Base Layer.Melee5"</span>))
        {
            if (<span class="keyword">state</span>Info0.normalizedTime &gt; <span class="number">0.1</span> &amp;&amp; <span class="keyword">state</span>Info0.normalizedTime <span class="variable">&lt; 0.8)
            {
                _trail.Emit = true;
            }
            else
            {
                _trail.Emit = false;
            }
        }
    }
}    </span>
</code></pre><p>以上涉及到的脚本已经存到百度网盘：<a href="http://pan.baidu.com/s/1o6ynzN8" target="_blank" rel="external">http://pan.baidu.com/s/1o6ynzN8</a></p>
<p><a href="https://www.assetstore.unity3d.com/en/#!/content/1728" target="_blank" rel="external">https://www.assetstore.unity3d.com/en/#!/content/1728</a> 这是Unity3D assetstore上的基于上述的工程。<a href="http://pan.baidu.com/s/1gdGIBVd这是该工程的我的网盘链接" target="_blank" rel="external">http://pan.baidu.com/s/1gdGIBVd这是该工程的我的网盘链接</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/插件/">插件</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D音频视频相关" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/01/Unity3D音频视频相关/" class="article-date">
  	<time datetime="2015-09-30T17:10:06.000Z" itemprop="datePublished">2015-10-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/01/Unity3D音频视频相关/">Unity3D音频视频相关</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>音频视频<br>unity3d支持的音频文件格式：.aif, .wav, .mp3, 和 .ogg</p>
<p>视频格式：支持.mov, .mpg, .mpeg, .mp4, .avi, .asf,.ogg,.ogv格式</p>
<p>Ogg格式转换<br>1 在线工具：<br><a href="http://www.online-convert.com/" target="_blank" rel="external">http://www.online-convert.com/</a><br>2 TheoraConverter：<br>老软件了，好几年没有更新了。<br><a href="http://sourceforge.net/projects/theoraconverter/" target="_blank" rel="external">http://sourceforge.net/projects/theoraconverter/</a> 可以下载到1.1版本的，貌似没有格式选择，测试了一下转换后为ogv格式的。<br><a href="http://theora-converter-net.software.informer.com/download/" target="_blank" rel="external">http://theora-converter-net.software.informer.com/download/</a> 这里提供的有2.6版本的，但是下载不下<br>2.6版本的多了格式选择，其它的没有详细比较。。。</p>
<p>我的网盘提供了1.1，2.6两个版本的 <a href="http://pan.baidu.com/s/1pJDHSuv" target="_blank" rel="external">http://pan.baidu.com/s/1pJDHSuv</a><br><img src="/img/Theora Converter.png" alt="Theora Converter"><br>如图为2.6的截图，第二个选项卡“Video”里面EncodingMode默认就是Bitrate 1000<br>若用默认值，转出来的视频马赛克严重，故该值越大越好，范围为后面小括号内的值。<br>另外也可以选择Quality，默认值是6，测试结果还可以。这个值越大越清晰，当然视频的大小也会大一些。。。<br>3： iDealshare VideoGo<br>这个没有测试，！！！蛋疼<br><a href="http://www.idealshare.net/video-converter/ogv-converter-for-mac-windows.html" target="_blank" rel="external">http://www.idealshare.net/video-converter/ogv-converter-for-mac-windows.html</a></p>
<p>4:vcl视频播放软件和miro Video Conterter软件<br><a href="http://www.videolan.org/" target="_blank" rel="external">http://www.videolan.org/</a><br><a href="http://www.mirovideoconverter.com/" target="_blank" rel="external">http://www.mirovideoconverter.com/</a><br>经过测试vcl和miro converter转换后的ogg（ogv）分辨率不行而且丢帧严重</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Unity3D中的小知识点杂记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/01/Unity3D中的小知识点杂记/" class="article-date">
  	<time datetime="2015-09-30T16:58:32.000Z" itemprop="datePublished">2015-10-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/01/Unity3D中的小知识点杂记/">Unity3D中的小知识点杂记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1:方法">1:方法</h1><h2 id="1-1_Quaternion-Euler">1.1 Quaternion.Euler</h2><p>欧拉角旋转，按照Z,X,Y的顺序旋转</p>
<h2 id="1-2_Quaternion-Angle">1.2 Quaternion.Angle</h2><p>static float Angle(Quaternion a, Quaternion b);<br>获得两个四元数之间的夹角，结果是两个z轴之间的夹角</p>
<h2 id="1-3_Quaternion-AngleAxis">1.3 Quaternion.AngleAxis</h2><p>static Quaternion AngleAxis(float angle, Vector3 axis);<br>经过测试，为某个物体设置围绕具体axis旋转的角度后，其余轴的旋转值会被设置为0.即使物体原始状态下其余轴的旋转值不为0.<br>angle可以设置为任意值，为负值时，表现在inspector面板上的物体旋转角度会被换算为正值(如-5会被换算为355)。若angle超过+-360°，也会被换算为[0,360）</p>
<h2 id="1-4_Object-FindObjectsOfType">1.4 Object.FindObjectsOfType</h2><p>static Object[] FindObjectsOfType(Type type);<br>Returns a list of all active loaded objects of Type type.<br>//这个函数是递归的，可以获得子物体。获得的是整个场景中某种类型的物体,若物体上有某个脚本（如abc.cs）,通过GameObject.FindObjectsOfType(typeof(abc)) 也可以获得到改物体</p>
<h2 id="1-5_获得当前场景名称">1.5 获得当前场景名称</h2><p><strong>编辑器模式下：</strong>Path.GetFileName(EditorApplication.currentScene)<br>EditorApplication.currentScene获得的是诸如Assets/XXX/XXX.unity这种路径。使用Path.GetFileName获得名称和后缀.unity<br><strong>运行模式下：</strong>Application.loadedLevelName获得的只是场景名称，无后缀</p>
<h2 id="1-6_获得机器唯一标识符">1.6 获得机器唯一标识符</h2><p>SystemInfo.deviceUniqueIdentifier<br>这个对于ios设备，ios7之前获取的才是唯一的，具体参见文档。<br>SystemInfo可以获得很多关于设备的参数信息。</p>
<p>3：清空console面板的输出<br>以下代码对4.3.4有效<br>        public static void ClearLog()<br>    {<br>        var assembly = Assembly.GetAssembly(typeof(UnityEditor.ActiveEditorTracker));//注意Assembly需要使用using System.Reflection<br>        var type = assembly.GetType(“UnityEditorInternal.LogEntries”);<br>        var method = type.GetMethod(“Clear”);<br>        method.Invoke(new object(), null);<br>}<br>适用于运行时、适用于Editor<br><a href="http://answers.unity3d.com/questions/10580/editor-script-how-to-clear-the-console-output-wind.html" target="_blank" rel="external">http://answers.unity3d.com/questions/10580/editor-script-how-to-clear-the-console-output-wind.html</a></p>
<p>平台依赖编译<br><a href="https://docs.unity3d.com/Documentation/Manual/PlatformDependentCompilation.html" target="_blank" rel="external">https://docs.unity3d.com/Documentation/Manual/PlatformDependentCompilation.html</a><br>结合#if #elif #else #endif及||使用<br>运行时平台<br>RuntimePlatform<br> if (Application.platform == RuntimePlatform.WindowsEditor || Application.platform == RuntimePlatform.WindowsPlayer)</p>
<p>Rich Text<br>Unity Manual-&gt;Advanced 支持对GUI中的字体和Debug中的字符，支持的tag有<br><b></b><br><i></i></p>
<p><size=30></size=30></p>
<color=#00ffffff>或<color=red>



<p>通过代码执行菜单项：<br>EditorApplication.ExecuteMenuItem(“GameObject/Create Other/Cube”)</p>
<p>Color<br>程序中Color范围为[0,1]</p>
<p>碰撞设置：<br>1，通过Edit-&gt;ProjectSettings-&gt;Physics<br>来设置全局的碰撞矩阵。<br>代码中也可以使用Physics.IgnoreLayerCollision来设置具体两个layer之间的碰撞关系。<br>static void IgnoreLayerCollision(int layer1, int layer2, bool ignore = true);<br>如：<br>Physics.IgnoreLayerCollision(9, 12, true);<br>这里的int型的layer1,layer2对应的就是Layer的Index，不需要进行位运算</p>
<p>忽略两个collider之间的碰撞，可以使用方法Physics.IgnoreCollision()</p>
</color=red></color=#00ffffff>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 bbbbbbion
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>